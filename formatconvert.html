<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FormatConvert Pro - Конвертер форматов</title>
    <meta name="description" content="Конвертируйте изображения, текст и данные между разными форматами прямо в браузере. Быстро, безопасно, без загрузки на сервер">
    <!-- Библиотеки для работы с изображениями -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary: #06b6d4;
            --primary-dark: #0891b2;
            --primary-light: #67e8f9;
            --secondary: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #cffafe 0%, #e0f2fe 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(6, 182, 212, 0.3);
        }
        
        .logo-text {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .tagline {
            color: var(--gray);
            font-size: 18px;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Left Panel - Converter */
        .converter-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }
        
        .panel-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title i {
            color: var(--primary);
        }
        
        /* Converter Type */
        .converter-type {
            margin-bottom: 30px;
        }
        
        .type-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .type-btn {
            padding: 12px 24px;
            background: var(--light);
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 140px;
            justify-content: center;
        }
        
        .type-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .type-btn:hover:not(.active) {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        /* Converter Forms */
        .converter-form {
            display: none;
        }
        
        .converter-form.active {
            display: block;
        }
        
        .upload-area {
            border: 3px dashed var(--gray-light);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--light);
            margin-bottom: 20px;
        }
        
        .upload-area:hover, .upload-area.dragover {
            border-color: var(--primary);
            background: rgba(6, 182, 212, 0.05);
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .upload-text {
            color: var(--gray);
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .upload-btn {
            display: inline-block;
            padding: 10px 25px;
            background: var(--primary);
            color: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .file-input {
            display: none;
        }
        
        .file-list {
            margin-top: 20px;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .file-item:hover {
            background: rgba(6, 182, 212, 0.1);
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .file-icon {
            font-size: 24px;
            color: var(--primary);
        }
        
        .file-details {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            margin-bottom: 4px;
            word-break: break-all;
        }
        
        .file-size {
            font-size: 12px;
            color: var(--gray);
        }
        
        .file-remove {
            background: var(--danger);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .file-remove:hover {
            background: #dc2626;
            transform: scale(1.1);
        }
        
        /* Format Selection */
        .format-selection {
            margin: 30px 0;
        }
        
        .format-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }
        
        .format-option {
            padding: 15px;
            background: var(--light);
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .format-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .format-option.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .format-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .format-name {
            font-weight: 600;
            font-size: 14px;
        }
        
        /* Settings */
        .settings-section {
            margin-bottom: 30px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .setting-label {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .setting-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            background: white;
        }
        
        .setting-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider {
            flex: 1;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--gray-light);
            border-radius: 3px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
            color: var(--primary);
        }
        
        /* Text Area */
        .text-area {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid var(--gray-light);
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            background: var(--light);
        }
        
        .text-area:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.3);
        }
        
        .btn-secondary {
            background: var(--light);
            border: 2px solid var(--gray-light);
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* Right Panel - Preview */
        .preview-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
        }
        
        .preview-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            background: var(--light);
            border-radius: 15px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .preview-placeholder {
            text-align: center;
            color: var(--gray);
            padding: 20px;
        }
        
        .preview-placeholder-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .preview-content {
            max-width: 100%;
            max-height: 100%;
            padding: 20px;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .preview-text {
            white-space: pre-wrap;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: white;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            width: 100%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }
        
        /* Info Panel */
        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .info-card {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
        }
        
        .info-label {
            font-size: 12px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            display: block;
        }
        
        .info-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
        }
        
        /* Export Section */
        .export-section {
            margin-top: auto;
        }
        
        .export-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .export-btn {
            flex: 1;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            min-width: 140px;
        }
        
        .export-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .export-btn.secondary {
            background: var(--light);
            border: 2px solid var(--gray-light);
            color: var(--dark);
        }
        
        .export-btn.secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .export-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .export-btn.copied {
            background: var(--success);
        }
        
        /* History Section */
        .history-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            margin-top: 40px;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
        }
        
        .history-item {
            background: var(--light);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            text-align: center;
        }
        
        .history-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }
        
        .history-icon {
            font-size: 32px;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .history-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .history-details {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
            border-left: 4px solid var(--success);
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            border-left-color: var(--danger);
        }
        
        /* Loading */
        .loading {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            border-radius: 15px;
            z-index: 10;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .type-buttons {
                flex-direction: column;
            }
            
            .format-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .export-options {
                flex-direction: column;
            }
            
            .history-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .preview-container {
                min-height: 300px;
            }
            
            .btn, .export-btn {
                min-width: auto;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="logo-text">FormatConvert Pro</div>
            </div>
            <p class="tagline">Конвертируйте изображения, текст и данные между разными форматами прямо в браузере. Быстро, безопасно, без загрузки на сервер</p>
        </header>
        
        <!-- Main Content -->
        <div class="main-grid">
            <!-- Left Panel - Converter -->
            <div class="converter-panel">
                <h2 class="panel-title">
                    <i class="fas fa-cogs"></i>
                    Конвертер
                </h2>
                
                <!-- Converter Type -->
                <div class="converter-type">
                    <div class="type-buttons" id="typeButtons">
                        <button class="type-btn active" data-type="image">
                            <i class="fas fa-image"></i> Изображения
                        </button>
                        <button class="type-btn" data-type="text">
                            <i class="fas fa-font"></i> Текст
                        </button>
                        <button class="type-btn" data-type="data">
                            <i class="fas fa-database"></i> Данные
                        </button>
                        <button class="type-btn" data-type="batch">
                            <i class="fas fa-layer-group"></i> Пакетная
                        </button>
                    </div>
                    
                    <!-- Image Converter -->
                    <div class="converter-form active" id="imageForm">
                        <div class="upload-area" id="imageUploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">Перетащите изображение сюда или</div>
                            <div class="upload-btn">Выберите файл</div>
                            <input type="file" class="file-input" id="imageFileInput" accept="image/*" multiple>
                        </div>
                        
                        <div class="file-list" id="imageFileList">
                            <!-- Файлы будут добавлены здесь -->
                        </div>
                        
                        <div class="format-selection">
                            <h3 class="panel-title">
                                <i class="fas fa-file-export"></i>
                                Конвертировать в:
                            </h3>
                            <div class="format-grid" id="imageFormatGrid">
                                <!-- Форматы будут добавлены через JS -->
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3 class="panel-title">
                                <i class="fas fa-sliders-h"></i>
                                Настройки изображения
                            </h3>
                            <div class="settings-grid">
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <i class="fas fa-compress-alt"></i>
                                        Качество
                                    </label>
                                    <div class="slider-container">
                                        <input type="range" min="10" max="100" value="85" class="slider" id="qualitySlider">
                                        <span class="slider-value" id="qualityValue">85%</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <label class="setting-label">
                                        <i class="fas fa-expand-alt"></i>
                                        Размер
                                    </label>
                                    <div class="slider-container">
                                        <input type="range" min="10" max="200" value="100" class="slider" id="sizeSlider">
                                        <span class="slider-value" id="sizeValue">100%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Text Converter -->
                    <div class="converter-form" id="textForm">
                        <div class="upload-area" id="textUploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="upload-text">Перетащите текстовый файл сюда или</div>
                            <div class="upload-btn">Выберите файл</div>
                            <input type="file" class="file-input" id="textFileInput" accept=".txt,.html,.xml,.json,.csv">
                        </div>
                        
                        <div class="format-selection">
                            <h3 class="panel-title">
                                <i class="fas fa-file-export"></i>
                                Конвертировать в:
                            </h3>
                            <div class="format-grid" id="textFormatGrid">
                                <!-- Форматы будут добавлены через JS -->
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3 class="panel-title">
                                <i class="fas fa-edit"></i>
                                Или введите текст вручную
                            </h3>
                            <textarea class="text-area" id="textInput" placeholder="Введите текст для конвертации..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Data Converter -->
                    <div class="converter-form" id="dataForm">
                        <div class="upload-area" id="dataUploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-table"></i>
                            </div>
                            <div class="upload-text">Перетащите файл данных сюда или</div>
                            <div class="upload-btn">Выберите файл</div>
                            <input type="file" class="file-input" id="dataFileInput" accept=".csv,.json,.xml,.xlsx">
                        </div>
                        
                        <div class="format-selection">
                            <h3 class="panel-title">
                                <i class="fas fa-file-export"></i>
                                Конвертировать в:
                            </h3>
                            <div class="format-grid" id="dataFormatGrid">
                                <!-- Форматы будут добавлены через JS -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Batch Converter -->
                    <div class="converter-form" id="batchForm">
                        <div class="upload-area" id="batchUploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-folder-open"></i>
                            </div>
                            <div class="upload-text">Перетащите несколько файлов сюда или</div>
                            <div class="upload-btn">Выберите файлы</div>
                            <input type="file" class="file-input" id="batchFileInput" accept="image/*,.txt,.csv,.json" multiple>
                        </div>
                        
                        <div class="file-list" id="batchFileList">
                            <!-- Файлы будут добавлены здесь -->
                        </div>
                        
                        <div class="format-selection">
                            <h3 class="panel-title">
                                <i class="fas fa-file-export"></i>
                                Конвертировать в:
                            </h3>
                            <div class="format-grid" id="batchFormatGrid">
                                <!-- Форматы будут добавлены через JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="convertBtn">
                        <i class="fas fa-sync-alt"></i>
                        Конвертировать
                    </button>
                    <button class="btn btn-secondary" id="resetBtn">
                        <i class="fas fa-redo"></i>
                        Сбросить
                    </button>
                </div>
            </div>
            
            <!-- Right Panel - Preview -->
            <div class="preview-panel">
                <h2 class="panel-title">
                    <i class="fas fa-eye"></i>
                    Предпросмотр
                </h2>
                
                <!-- Preview Container -->
                <div class="preview-container">
                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <p>Конвертируем файл...</p>
                    </div>
                    
                    <div class="preview-placeholder" id="previewPlaceholder">
                        <div class="preview-placeholder-icon">
                            <i class="fas fa-file"></i>
                        </div>
                        <p>Выберите файл для конвертации<br>и настройте параметры</p>
                    </div>
                    
                    <div class="preview-content" id="previewContent" style="display: none;">
                        <!-- Контент будет отображаться здесь -->
                    </div>
                </div>
                
                <!-- Info Panel -->
                <div class="info-panel" id="infoPanel" style="display: none;">
                    <div class="info-card">
                        <span class="info-label">Исходный формат</span>
                        <div class="info-value" id="infoOriginal">-</div>
                    </div>
                    <div class="info-card">
                        <span class="info-label">Целевой формат</span>
                        <div class="info-value" id="infoTarget">-</div>
                    </div>
                    <div class="info-card">
                        <span class="info-label">Размер файла</span>
                        <div class="info-value" id="infoSize">-</div>
                    </div>
                    <div class="info-card">
                        <span class="info-label">Время обработки</span>
                        <div class="info-value" id="infoTime">-</div>
                    </div>
                </div>
                
                <!-- Export Section -->
                <div class="export-section">
                    <h3 class="panel-title">
                        <i class="fas fa-download"></i>
                        Экспорт
                    </h3>
                    
                    <div class="export-options" id="exportOptions">
                        <button class="export-btn" id="downloadBtn" disabled>
                            <i class="fas fa-download"></i>
                            Скачать файл
                        </button>
                        <button class="export-btn secondary" id="copyBtn" disabled>
                            <i class="far fa-copy"></i>
                            Копировать
                        </button>
                        <button class="export-btn secondary" id="saveTemplateBtn" disabled>
                            <i class="far fa-save"></i>
                            Сохранить шаблон
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- History Section -->
        <div class="history-section">
            <div class="history-header">
                <h2 class="panel-title">
                    <i class="fas fa-history"></i>
                    История конвертаций
                </h2>
                <button class="btn btn-secondary" id="clearHistoryBtn">
                    <i class="fas fa-trash"></i>
                    Очистить историю
                </button>
            </div>
            
            <div class="history-grid" id="historyGrid">
                <!-- History items will be generated here -->
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Конвертация завершена!</span>
    </div>

    <script>
        // Инициализация
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        // Основные переменные
        let currentType = 'image';
        let currentFiles = [];
        let currentFormat = null;
        let convertedData = null;
        let conversionHistory = JSON.parse(localStorage.getItem('formatconvert_history')) || [];
        
        // Поддерживаемые форматы
        const formats = {
            image: [
                { id: 'png', name: 'PNG', icon: 'far fa-file-image', mime: 'image/png' },
                { id: 'jpg', name: 'JPG', icon: 'far fa-file-image', mime: 'image/jpeg' },
                { id: 'webp', name: 'WebP', icon: 'far fa-file-image', mime: 'image/webp' },
                { id: 'svg', name: 'SVG', icon: 'far fa-file-image', mime: 'image/svg+xml' },
                { id: 'ico', name: 'ICO', icon: 'far fa-file-image', mime: 'image/x-icon' },
                { id: 'bmp', name: 'BMP', icon: 'far fa-file-image', mime: 'image/bmp' }
            ],
            text: [
                { id: 'txt', name: 'TXT', icon: 'far fa-file-alt', mime: 'text/plain' },
                { id: 'html', name: 'HTML', icon: 'fab fa-html5', mime: 'text/html' },
                { id: 'json', name: 'JSON', icon: 'fas fa-code', mime: 'application/json' },
                { id: 'xml', name: 'XML', icon: 'far fa-file-code', mime: 'application/xml' },
                { id: 'csv', name: 'CSV', icon: 'fas fa-table', mime: 'text/csv' },
                { id: 'md', name: 'Markdown', icon: 'fas fa-bold', mime: 'text/markdown' }
            ],
            data: [
                { id: 'json', name: 'JSON', icon: 'fas fa-code', mime: 'application/json' },
                { id: 'csv', name: 'CSV', icon: 'fas fa-table', mime: 'text/csv' },
                { id: 'xml', name: 'XML', icon: 'far fa-file-code', mime: 'application/xml' },
                { id: 'yaml', name: 'YAML', icon: 'far fa-file', mime: 'text/yaml' },
                { id: 'txt', name: 'TXT', icon: 'far fa-file-alt', mime: 'text/plain' }
            ],
            batch: [
                { id: 'zip', name: 'ZIP архив', icon: 'far fa-file-archive', mime: 'application/zip' },
                { id: 'png', name: 'PNG', icon: 'far fa-file-image', mime: 'image/png' },
                { id: 'jpg', name: 'JPG', icon: 'far fa-file-image', mime: 'image/jpeg' },
                { id: 'pdf', name: 'PDF', icon: 'far fa-file-pdf', mime: 'application/pdf' }
            ]
        };

        // DOM элементы
        const elements = {
            // Type buttons
            typeButtons: document.getElementById('typeButtons'),
            
            // Forms
            imageForm: document.getElementById('imageForm'),
            textForm: document.getElementById('textForm'),
            dataForm: document.getElementById('dataForm'),
            batchForm: document.getElementById('batchForm'),
            
            // Upload areas
            imageUploadArea: document.getElementById('imageUploadArea'),
            textUploadArea: document.getElementById('textUploadArea'),
            dataUploadArea: document.getElementById('dataUploadArea'),
            batchUploadArea: document.getElementById('batchUploadArea'),
            
            // File inputs
            imageFileInput: document.getElementById('imageFileInput'),
            textFileInput: document.getElementById('textFileInput'),
            dataFileInput: document.getElementById('dataFileInput'),
            batchFileInput: document.getElementById('batchFileInput'),
            
            // File lists
            imageFileList: document.getElementById('imageFileList'),
            batchFileList: document.getElementById('batchFileList'),
            
            // Format grids
            imageFormatGrid: document.getElementById('imageFormatGrid'),
            textFormatGrid: document.getElementById('textFormatGrid'),
            dataFormatGrid: document.getElementById('dataFormatGrid'),
            batchFormatGrid: document.getElementById('batchFormatGrid'),
            
            // Settings
            qualitySlider: document.getElementById('qualitySlider'),
            qualityValue: document.getElementById('qualityValue'),
            sizeSlider: document.getElementById('sizeSlider'),
            sizeValue: document.getElementById('sizeValue'),
            textInput: document.getElementById('textInput'),
            
            // Buttons
            convertBtn: document.getElementById('convertBtn'),
            resetBtn: document.getElementById('resetBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            copyBtn: document.getElementById('copyBtn'),
            saveTemplateBtn: document.getElementById('saveTemplateBtn'),
            clearHistoryBtn: document.getElementById('clearHistoryBtn'),
            
            // Preview
            previewPlaceholder: document.getElementById('previewPlaceholder'),
            previewContent: document.getElementById('previewContent'),
            loading: document.getElementById('loading'),
            
            // Info panel
            infoPanel: document.getElementById('infoPanel'),
            infoOriginal: document.getElementById('infoOriginal'),
            infoTarget: document.getElementById('infoTarget'),
            infoSize: document.getElementById('infoSize'),
            infoTime: document.getElementById('infoTime'),
            
            // History
            historyGrid: document.getElementById('historyGrid'),
            
            // Notification
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notificationText')
        };

        // Инициализация приложения
        function initApp() {
            setupEventListeners();
            setupDragAndDrop();
            initFormatGrids();
            loadHistory();
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Переключение типа конвертера
            elements.typeButtons.addEventListener('click', function(e) {
                if (e.target.classList.contains('type-btn')) {
                    const type = e.target.dataset.type;
                    switchType(type);
                }
            });
            
            // Слайдеры
            elements.qualitySlider.addEventListener('input', function() {
                elements.qualityValue.textContent = this.value + '%';
            });
            
            elements.sizeSlider.addEventListener('input', function() {
                elements.sizeValue.textContent = this.value + '%';
            });
            
            // Выбор файлов
            elements.imageFileInput.addEventListener('change', handleImageFiles);
            elements.textFileInput.addEventListener('change', handleTextFile);
            elements.dataFileInput.addEventListener('change', handleDataFile);
            elements.batchFileInput.addEventListener('change', handleBatchFiles);
            
            // Кнопки
            elements.convertBtn.addEventListener('click', convert);
            elements.resetBtn.addEventListener('click', reset);
            elements.downloadBtn.addEventListener('click', download);
            elements.copyBtn.addEventListener('click', copyToClipboard);
            elements.saveTemplateBtn.addEventListener('click', saveTemplate);
            elements.clearHistoryBtn.addEventListener('click', clearHistory);
        }

        // Настройка Drag & Drop
        function setupDragAndDrop() {
            const uploadAreas = [
                elements.imageUploadArea,
                elements.textUploadArea,
                elements.dataUploadArea,
                elements.batchUploadArea
            ];
            
            uploadAreas.forEach(area => {
                area.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                area.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });
                
                area.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleDroppedFiles(this.id, files);
                    }
                });
                
                // Клик по области загрузки
                area.querySelector('.upload-btn').addEventListener('click', function() {
                    const inputId = this.closest('.converter-form').querySelector('.file-input').id;
                    document.getElementById(inputId).click();
                });
            });
        }

        // Инициализация сетки форматов
        function initFormatGrids() {
            // Изображения
            formats.image.forEach(format => {
                const option = createFormatOption(format, 'image');
                elements.imageFormatGrid.appendChild(option);
            });
            
            // Текст
            formats.text.forEach(format => {
                const option = createFormatOption(format, 'text');
                elements.textFormatGrid.appendChild(option);
            });
            
            // Данные
            formats.data.forEach(format => {
                const option = createFormatOption(format, 'data');
                elements.dataFormatGrid.appendChild(option);
            });
            
            // Пакетная
            formats.batch.forEach(format => {
                const option = createFormatOption(format, 'batch');
                elements.batchFormatGrid.appendChild(option);
            });
            
            // Выбрать первый формат по умолчанию
            selectFirstFormat();
        }

        // Создание элемента формата
        function createFormatOption(format, type) {
            const div = document.createElement('div');
            div.className = 'format-option';
            div.dataset.id = format.id;
            div.dataset.type = type;
            
            div.innerHTML = `
                <div class="format-icon">
                    <i class="${format.icon}"></i>
                </div>
                <div class="format-name">${format.name}</div>
            `;
            
            div.addEventListener('click', function() {
                selectFormat(format.id, type);
            });
            
            return div;
        }

        // Выбор первого формата
        function selectFirstFormat() {
            const firstFormat = document.querySelector('.format-option');
            if (firstFormat) {
                const formatId = firstFormat.dataset.id;
                const type = firstFormat.dataset.type;
                selectFormat(formatId, type);
            }
        }

        // Выбор формата
        function selectFormat(formatId, type) {
            // Снять выделение со всех форматов этого типа
            const allFormats = document.querySelectorAll(`.format-option[data-type="${type}"]`);
            allFormats.forEach(option => {
                option.classList.remove('active');
            });
            
            // Выделить выбранный формат
            const selectedFormat = document.querySelector(`.format-option[data-id="${formatId}"][data-type="${type}"]`);
            if (selectedFormat) {
                selectedFormat.classList.add('active');
                currentFormat = formatId;
            }
        }

        // Переключение типа конвертера
        function switchType(type) {
            currentType = type;
            currentFiles = [];
            
            // Обновить активную кнопку типа
            document.querySelectorAll('.type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
            
            // Показать соответствующую форму
            document.querySelectorAll('.converter-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`${type}Form`).classList.add('active');
            
            // Очистить предпросмотр
            clearPreview();
            
            // Сбросить файловые списки
            clearFileLists();
            
            // Выбрать первый формат для нового типа
            const firstFormat = document.querySelector(`.format-option[data-type="${type}"]`);
            if (firstFormat) {
                selectFormat(firstFormat.dataset.id, type);
            }
            
            // Обновить состояние кнопок
            updateButtonsState();
        }

        // Обработка перетаскиваемых файлов
        function handleDroppedFiles(uploadAreaId, files) {
            switch(uploadAreaId) {
                case 'imageUploadArea':
                    handleImageFiles({ target: { files: files } });
                    break;
                case 'textUploadArea':
                    handleTextFile({ target: { files: files } });
                    break;
                case 'dataUploadArea':
                    handleDataFile({ target: { files: files } });
                    break;
                case 'batchUploadArea':
                    handleBatchFiles({ target: { files: files } });
                    break;
            }
        }

        // Обработка изображений
        function handleImageFiles(event) {
            const files = Array.from(event.target.files);
            currentFiles = files;
            
            // Очистить список файлов
            elements.imageFileList.innerHTML = '';
            
            // Добавить файлы в список
            files.forEach((file, index) => {
                addFileToImageList(file, index);
            });
            
            // Показать предпросмотр первого изображения
            if (files.length > 0) {
                previewImage(files[0]);
            }
            
            updateButtonsState();
        }

        // Добавление файла в список изображений
        function addFileToImageList(file, index) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.dataset.index = index;
            
            const fileSize = formatFileSize(file.size);
            const fileName = file.name.length > 30 ? file.name.substring(0, 27) + '...' : file.name;
            
            fileItem.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="file-details">
                        <div class="file-name">${fileName}</div>
                        <div class="file-size">${fileSize} • ${getFileExtension(file.name).toUpperCase()}</div>
                    </div>
                </div>
                <button class="file-remove" data-index="${index}">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            elements.imageFileList.appendChild(fileItem);
            
            // Обработчик удаления файла
            fileItem.querySelector('.file-remove').addEventListener('click', function(e) {
                e.stopPropagation();
                removeImageFile(index);
            });
            
            // Клик по файлу для предпросмотра
            fileItem.addEventListener('click', function() {
                previewImage(file);
            });
        }

        // Удаление изображения из списка
        function removeImageFile(index) {
            currentFiles.splice(index, 1);
            handleImageFiles({ target: { files: currentFiles } });
        }

        // Обработка текстового файла
        function handleTextFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                elements.textInput.value = e.target.result;
                previewText(e.target.result);
                
                // Сохранить файл
                currentFiles = [file];
                updateButtonsState();
            };
            reader.readAsText(file);
        }

        // Обработка файла данных
        function handleDataFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                previewData(content, file.name);
                
                // Сохранить файл
                currentFiles = [file];
                updateButtonsState();
            };
            
            const ext = getFileExtension(file.name);
            if (ext === 'json' || ext === 'txt' || ext === 'csv' || ext === 'xml') {
                reader.readAsText(file);
            } else {
                reader.readAsDataURL(file);
            }
        }

        // Обработка пакетных файлов
        function handleBatchFiles(event) {
            const files = Array.from(event.target.files);
            currentFiles = files;
            
            // Очистить список файлов
            elements.batchFileList.innerHTML = '';
            
            // Добавить файлы в список
            files.forEach((file, index) => {
                addFileToBatchList(file, index);
            });
            
            updateButtonsState();
        }

        // Добавление файла в пакетный список
        function addFileToBatchList(file, index) {
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item';
            fileItem.dataset.index = index;
            
            const fileSize = formatFileSize(file.size);
            const fileName = file.name.length > 30 ? file.name.substring(0, 27) + '...' : file.name;
            const fileType = getFileTypeIcon(file.name);
            
            fileItem.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">
                        <i class="${fileType.icon}"></i>
                    </div>
                    <div class="file-details">
                        <div class="file-name">${fileName}</div>
                        <div class="file-size">${fileSize} • ${fileType.ext.toUpperCase()}</div>
                    </div>
                </div>
                <button class="file-remove" data-index="${index}">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            elements.batchFileList.appendChild(fileItem);
            
            // Обработчик удаления файла
            fileItem.querySelector('.file-remove').addEventListener('click', function(e) {
                e.stopPropagation();
                removeBatchFile(index);
            });
        }

        // Удаление файла из пакетного списка
        function removeBatchFile(index) {
            currentFiles.splice(index, 1);
            handleBatchFiles({ target: { files: currentFiles } });
        }

        // Очистка списков файлов
        function clearFileLists() {
            elements.imageFileList.innerHTML = '';
            elements.batchFileList.innerHTML = '';
            elements.textInput.value = '';
        }

        // Предпросмотр изображения
        function previewImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.className = 'preview-image';
                img.src = e.target.result;
                img.alt = 'Preview';
                
                elements.previewContent.innerHTML = '';
                elements.previewContent.appendChild(img);
                elements.previewContent.style.display = 'block';
                elements.previewPlaceholder.style.display = 'none';
                
                // Обновить информацию
                updateInfoPanel(file.name, currentFormat, file.size);
            };
            reader.readAsDataURL(file);
        }

        // Предпросмотр текста
        function previewText(text) {
            const pre = document.createElement('pre');
            pre.className = 'preview-text';
            pre.textContent = text;
            
            elements.previewContent.innerHTML = '';
            elements.previewContent.appendChild(pre);
            elements.previewContent.style.display = 'block';
            elements.previewPlaceholder.style.display = 'none';
            
            // Обновить информацию
            updateInfoPanel('text.txt', currentFormat, new Blob([text]).size);
        }

        // Предпросмотр данных
        function previewData(content, fileName) {
            const ext = getFileExtension(fileName);
            let displayContent = content;
            
            if (ext === 'json') {
                try {
                    const json = JSON.parse(content);
                    displayContent = JSON.stringify(json, null, 2);
                } catch (e) {
                    // Оставить как есть
                }
            }
            
            const pre = document.createElement('pre');
            pre.className = 'preview-text';
            pre.textContent = displayContent.substring(0, 10000); // Ограничение на предпросмотр
            
            elements.previewContent.innerHTML = '';
            elements.previewContent.appendChild(pre);
            elements.previewContent.style.display = 'block';
            elements.previewPlaceholder.style.display = 'none';
            
            // Обновить информацию
            updateInfoPanel(fileName, currentFormat, content.length);
        }

        // Очистка предпросмотра
        function clearPreview() {
            elements.previewContent.innerHTML = '';
            elements.previewContent.style.display = 'none';
            elements.previewPlaceholder.style.display = 'block';
            elements.infoPanel.style.display = 'none';
            elements.downloadBtn.disabled = true;
            elements.copyBtn.disabled = true;
            elements.saveTemplateBtn.disabled = true;
            convertedData = null;
        }

        // Обновление информационной панели
        function updateInfoPanel(originalFile, targetFormat, size) {
            const originalExt = getFileExtension(originalFile).toUpperCase();
            const targetExt = targetFormat.toUpperCase();
            
            elements.infoOriginal.textContent = originalExt;
            elements.infoTarget.textContent = targetExt;
            elements.infoSize.textContent = formatFileSize(size);
            elements.infoTime.textContent = new Date().toLocaleTimeString('ru-RU');
            elements.infoPanel.style.display = 'grid';
        }

        // Обновление состояния кнопок
        function updateButtonsState() {
            const hasFiles = currentFiles.length > 0 || (currentType === 'text' && elements.textInput.value.trim() !== '');
            const hasFormat = currentFormat !== null;
            
            elements.convertBtn.disabled = !hasFiles || !hasFormat;
        }

        // Конвертация
        function convert() {
            if (currentFiles.length === 0 && !(currentType === 'text' && elements.textInput.value.trim() !== '')) {
                showNotification('Выберите файл для конвертации', 'error');
                return;
            }
            
            if (!currentFormat) {
                showNotification('Выберите целевой формат', 'error');
                return;
            }
            
            elements.loading.style.display = 'flex';
            
            setTimeout(() => {
                try {
                    switch(currentType) {
                        case 'image':
                            convertImages();
                            break;
                        case 'text':
                            convertText();
                            break;
                        case 'data':
                            convertData();
                            break;
                        case 'batch':
                            convertBatch();
                            break;
                    }
                } catch (error) {
                    console.error('Conversion error:', error);
                    showNotification('Ошибка конвертации', 'error');
                    elements.loading.style.display = 'none';
                }
            }, 100);
        }

        // Конвертация изображений
        function convertImages() {
            if (currentFiles.length === 0) return;
            
            const file = currentFiles[0]; // Пока конвертируем только первый файл
            const quality = parseInt(elements.qualitySlider.value) / 100;
            const scale = parseInt(elements.sizeSlider.value) / 100;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width * scale;
                    canvas.height = img.height * scale;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    
                    // Получить данные в нужном формате
                    let mimeType = '';
                    switch(currentFormat) {
                        case 'jpg':
                            mimeType = 'image/jpeg';
                            break;
                        case 'png':
                            mimeType = 'image/png';
                            break;
                        case 'webp':
                            mimeType = 'image/webp';
                            break;
                        case 'svg':
                            // Простая SVG конвертация (для демо)
                            convertedData = generateSVG(img.width, img.height);
                            finishConversion(convertedData, 'image/svg+xml');
                            return;
                        default:
                            mimeType = 'image/png';
                    }
                    
                    canvas.toBlob(function(blob) {
                        convertedData = blob;
                        finishConversion(blob, mimeType);
                    }, mimeType, quality);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Генерация простого SVG (для демо)
        function generateSVG(width, height) {
            const svg = `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
                <rect width="100%" height="100%" fill="#ccc"/>
                <text x="50%" y="50%" text-anchor="middle" dy=".3em" font-family="Arial" font-size="20">
                    SVG конвертация (демо)
                </text>
            </svg>`;
            return new Blob([svg], { type: 'image/svg+xml' });
        }

        // Конвертация текста
        function convertText() {
            let text = elements.textInput.value.trim();
            
            if (text === '' && currentFiles.length > 0) {
                // Чтение из файла
                const reader = new FileReader();
                reader.onload = function(e) {
                    text = e.target.result;
                    processTextConversion(text);
                };
                reader.readAsText(currentFiles[0]);
            } else {
                processTextConversion(text);
            }
        }

        // Обработка конвертации текста
        function processTextConversion(text) {
            let result = text;
            let mimeType = 'text/plain';
            
            switch(currentFormat) {
                case 'html':
                    result = textToHTML(text);
                    mimeType = 'text/html';
                    break;
                case 'json':
                    result = textToJSON(text);
                    mimeType = 'application/json';
                    break;
                case 'xml':
                    result = textToXML(text);
                    mimeType = 'application/xml';
                    break;
                case 'csv':
                    result = textToCSV(text);
                    mimeType = 'text/csv';
                    break;
                case 'md':
                    result = text;
                    mimeType = 'text/markdown';
                    break;
                case 'txt':
                default:
                    result = text;
                    mimeType = 'text/plain';
            }
            
            convertedData = new Blob([result], { type: mimeType });
            finishConversion(convertedData, mimeType);
            
            // Предпросмотр результата
            previewText(result);
        }

        // Текст в HTML
        function textToHTML(text) {
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Конвертированный текст</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <pre>${text.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
</body>
</html>`;
        }

        // Текст в JSON
        function textToJSON(text) {
            try {
                // Пытаемся разобрать как JSON
                return JSON.stringify(JSON.parse(text), null, 2);
            } catch (e) {
                // Если не JSON, создаем простую структуру
                const lines = text.split('\n').filter(line => line.trim() !== '');
                return JSON.stringify({
                    content: text,
                    lines: lines,
                    lineCount: lines.length,
                    convertedAt: new Date().toISOString()
                }, null, 2);
            }
        }

        // Текст в XML
        function textToXML(text) {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
            xml += '<text>\n';
            xml += `  <metadata>\n`;
            xml += `    <converted>${new Date().toISOString()}</converted>\n`;
            xml += `    <lines>${lines.length}</lines>\n`;
            xml += `  </metadata>\n`;
            xml += `  <content>\n`;
            
            lines.forEach((line, index) => {
                const escapedLine = line.replace(/&/g, '&amp;')
                                      .replace(/</g, '&lt;')
                                      .replace(/>/g, '&gt;')
                                      .replace(/"/g, '&quot;')
                                      .replace(/'/g, '&apos;');
                xml += `    <line number="${index + 1}">${escapedLine}</line>\n`;
            });
            
            xml += `  </content>\n`;
            xml += '</text>';
            return xml;
        }

        // Текст в CSV
        function textToCSV(text) {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            let csv = 'Line Number,Content,Length\n';
            
            lines.forEach((line, index) => {
                const escapedLine = line.replace(/"/g, '""');
                csv += `${index + 1},"${escapedLine}",${line.length}\n`;
            });
            
            return csv;
        }

        // Конвертация данных
        function convertData() {
            if (currentFiles.length === 0) return;
            
            const file = currentFiles[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                const originalExt = getFileExtension(file.name);
                let result;
                let mimeType = 'text/plain';
                
                switch(currentFormat) {
                    case 'json':
                        result = convertToJSON(content, originalExt);
                        mimeType = 'application/json';
                        break;
                    case 'csv':
                        result = convertToCSV(content, originalExt);
                        mimeType = 'text/csv';
                        break;
                    case 'xml':
                        result = convertToXML(content, originalExt);
                        mimeType = 'application/xml';
                        break;
                    case 'yaml':
                        result = convertToYAML(content, originalExt);
                        mimeType = 'text/yaml';
                        break;
                    case 'txt':
                    default:
                        result = content;
                        mimeType = 'text/plain';
                }
                
                convertedData = new Blob([result], { type: mimeType });
                finishConversion(convertedData, mimeType);
                
                // Предпросмотр результата
                previewText(result.substring(0, 10000));
            };
            
            if (file.type.includes('text') || file.name.endsWith('.json') || 
                file.name.endsWith('.csv') || file.name.endsWith('.xml')) {
                reader.readAsText(file);
            } else {
                reader.readAsDataURL(file);
            }
        }

        // Конвертация в JSON
        function convertToJSON(content, originalExt) {
            try {
                switch(originalExt) {
                    case 'csv':
                        return csvToJSON(content);
                    case 'xml':
                        return xmlToJSON(content);
                    default:
                        // Пытаемся разобрать как JSON
                        const parsed = JSON.parse(content);
                        return JSON.stringify(parsed, null, 2);
                }
            } catch (e) {
                return JSON.stringify({
                    content: content,
                    error: "Could not parse as " + originalExt,
                    convertedAt: new Date().toISOString()
                }, null, 2);
            }
        }

        // CSV в JSON
        function csvToJSON(csv) {
            const lines = csv.split('\n').filter(line => line.trim() !== '');
            if (lines.length === 0) return '[]';
            
            const headers = lines[0].split(',').map(h => h.trim());
            const result = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const obj = {};
                
                headers.forEach((header, index) => {
                    obj[header] = values[index] ? values[index].trim() : '';
                });
                
                result.push(obj);
            }
            
            return JSON.stringify(result, null, 2);
        }

        // XML в JSON (упрощенная версия)
        function xmlToJSON(xml) {
            // Простая демо-версия
            return JSON.stringify({
                xml: xml.substring(0, 500) + (xml.length > 500 ? '...' : ''),
                length: xml.length,
                convertedAt: new Date().toISOString(),
                note: "Для полной конвертации XML в JSON используйте специализированные инструменты"
            }, null, 2);
        }

        // Конвертация в CSV
        function convertToCSV(content, originalExt) {
            try {
                switch(originalExt) {
                    case 'json':
                        return jsonToCSV(content);
                    default:
                        return content;
                }
            } catch (e) {
                return "Error converting to CSV";
            }
        }

        // JSON в CSV
        function jsonToCSV(json) {
            try {
                const data = JSON.parse(json);
                if (!Array.isArray(data)) {
                    data = [data];
                }
                
                if (data.length === 0) return '';
                
                const headers = Object.keys(data[0]);
                let csv = headers.join(',') + '\n';
                
                data.forEach(item => {
                    const row = headers.map(header => {
                        const value = item[header];
                        return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
                    }).join(',');
                    csv += row + '\n';
                });
                
                return csv;
            } catch (e) {
                return json;
            }
        }

        // Конвертация в XML
        function convertToXML(content, originalExt) {
            // Демо-версия
            return `<?xml version="1.0" encoding="UTF-8"?>
<convertedData>
    <originalFormat>${originalExt}</originalFormat>
    <convertedAt>${new Date().toISOString()}</convertedAt>
    <content>${content.substring(0, 1000)}${content.length > 1000 ? '...' : ''}</content>
    <note>Конвертация из ${originalExt} в XML (демо-версия)</note>
</convertedData>`;
        }

        // Конвертация в YAML
        function convertToYAML(content, originalExt) {
            // Демо-версия
            return `# Конвертировано из ${originalExt} в YAML
convertedAt: ${new Date().toISOString()}
originalFormat: ${originalExt}
contentLength: ${content.length}
note: Конвертация в YAML (демо-версия)
contentPreview: ${content.substring(0, 200)}${content.length > 200 ? '...' : ''}`;
        }

        // Пакетная конвертация
        function convertBatch() {
            if (currentFiles.length === 0) return;
            
            if (currentFormat === 'zip') {
                // Создание ZIP архива
                createZipArchive();
            } else {
                // Конвертация всех файлов в один формат
                convertAllToFormat();
            }
        }

        // Создание ZIP архива
        function createZipArchive() {
            const zip = new JSZip();
            
            // Добавить все файлы в архив
            currentFiles.forEach(file => {
                zip.file(file.name, file);
            });
            
            // Генерировать ZIP
            zip.generateAsync({ type: 'blob' })
                .then(function(blob) {
                    convertedData = blob;
                    finishConversion(blob, 'application/zip');
                    showNotification('ZIP архив создан!');
                })
                .catch(function(error) {
                    console.error('ZIP creation error:', error);
                    showNotification('Ошибка создания ZIP архива', 'error');
                    elements.loading.style.display = 'none';
                });
        }

        // Конвертация всех файлов в один формат
        function convertAllToFormat() {
            // Демо-версия: конвертируем только первый файл
            if (currentFiles.length > 0) {
                const file = currentFiles[0];
                handleImageFiles({ target: { files: [file] } });
                convertImages();
            }
        }

        // Завершение конвертации
        function finishConversion(data, mimeType) {
            elements.loading.style.display = 'none';
            elements.downloadBtn.disabled = false;
            elements.copyBtn.disabled = false;
            elements.saveTemplateBtn.disabled = false;
            
            // Сохранить в историю
            saveToHistory(mimeType);
            
            showNotification('Конвертация завершена успешно!');
        }

        // Скачивание
        function download() {
            if (!convertedData) return;
            
            let fileName = `converted.${currentFormat}`;
            if (currentFiles.length > 0) {
                const originalName = currentFiles[0].name;
                const nameWithoutExt = originalName.substring(0, originalName.lastIndexOf('.'));
                fileName = `${nameWithoutExt}.${currentFormat}`;
            }
            
            saveAs(convertedData, fileName);
            showNotification('Файл скачан!');
        }

        // Копирование в буфер обмена
        function copyToClipboard() {
            if (!convertedData) return;
            
            if (convertedData.type.includes('text')) {
                // Для текстовых файлов
                convertedData.text().then(text => {
                    navigator.clipboard.writeText(text).then(() => {
                        showNotification('Текст скопирован в буфер!');
                    });
                });
            } else {
                // Для бинарных файлов
                const btn = elements.copyBtn;
                const originalText = btn.innerHTML;
                
                btn.innerHTML = '<i class="fas fa-check"></i> Скопировано!';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('copied');
                }, 2000);
                
                showNotification('Для изображений используйте скачивание');
            }
        }

        // Сохранение шаблона
        function saveTemplate() {
            const template = {
                type: currentType,
                format: currentFormat,
                quality: elements.qualitySlider.value,
                scale: elements.sizeSlider.value,
                timestamp: new Date().toISOString()
            };
            
            const templates = JSON.parse(localStorage.getItem('formatconvert_templates') || '[]');
            templates.push(template);
            localStorage.setItem('formatconvert_templates', JSON.stringify(templates));
            
            showNotification('Шаблон сохранен!');
        }

        // Сброс
        function reset() {
            if (confirm('Вы уверены, что хотите сбросить все настройки?')) {
                currentFiles = [];
                convertedData = null;
                
                // Очистить поля
                elements.textInput.value = '';
                elements.qualitySlider.value = '85';
                elements.qualityValue.textContent = '85%';
                elements.sizeSlider.value = '100';
                elements.sizeValue.textContent = '100%';
                
                // Очистить предпросмотр
                clearPreview();
                clearFileLists();
                
                // Выбрать первый формат
                selectFirstFormat();
                
                showNotification('Настройки сброшены');
            }
        }

        // Сохранение в историю
        function saveToHistory(mimeType) {
            const historyItem = {
                id: Date.now(),
                type: currentType,
                format: currentFormat,
                mimeType: mimeType,
                fileCount: currentFiles.length,
                timestamp: new Date().toISOString(),
                dataSize: convertedData ? convertedData.size : 0
            };
            
            // Добавляем в начало массива
            conversionHistory.unshift(historyItem);
            
            // Ограничиваем историю 12 элементами
            if (conversionHistory.length > 12) {
                conversionHistory = conversionHistory.slice(0, 12);
            }
            
            // Сохраняем в localStorage
            localStorage.setItem('formatconvert_history', JSON.stringify(conversionHistory));
            
            // Обновляем отображение истории
            loadHistory();
        }

        // Загрузка истории
        function loadHistory() {
            elements.historyGrid.innerHTML = '';
            
            if (conversionHistory.length === 0) {
                elements.historyGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-exchange-alt" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                        <h3>История пуста</h3>
                        <p>Выполните первую конвертацию</p>
                    </div>
                `;
                return;
            }
            
            conversionHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.dataset.id = item.id;
                
                const typeIcons = {
                    image: 'fas fa-image',
                    text: 'fas fa-font',
                    data: 'fas fa-database',
                    batch: 'fas fa-layer-group'
                };
                
                const typeNames = {
                    image: 'Изображение',
                    text: 'Текст',
                    data: 'Данные',
                    batch: 'Пакет'
                };
                
                historyItem.innerHTML = `
                    <div class="history-icon">
                        <i class="${typeIcons[item.type]}"></i>
                    </div>
                    <div class="history-name">${typeNames[item.type]}</div>
                    <div class="history-details">
                        ${item.format.toUpperCase()} • ${formatFileSize(item.dataSize)}
                    </div>
                `;
                
                historyItem.addEventListener('click', () => {
                    loadFromHistory(item.id);
                });
                
                elements.historyGrid.appendChild(historyItem);
            });
        }

        // Загрузка из истории
        function loadFromHistory(id) {
            const item = conversionHistory.find(item => item.id == id);
            if (!item) return;
            
            // Переключить на соответствующий тип
            switchType(item.type);
            
            // Выбрать формат
            selectFormat(item.format, item.type);
            
            showNotification(`Настройки загружены из истории!`);
        }

        // Очистка истории
        function clearHistory() {
            if (confirm('Вы уверены, что хотите очистить историю конвертаций?')) {
                conversionHistory = [];
                localStorage.removeItem('formatconvert_history');
                loadHistory();
                showNotification('История очищена!');
            }
        }

        // Показать уведомление
        function showNotification(message, type = 'success') {
            elements.notificationText.textContent = message;
            elements.notification.className = `notification ${type}`;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        // Вспомогательные функции

        // Форматирование размера файла
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Б';
            
            const k = 1024;
            const sizes = ['Б', 'КБ', 'МБ', 'ГБ'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Получение расширения файла
        function getFileExtension(filename) {
            return filename.slice((filename.lastIndexOf('.') - 1 >>> 0) + 2).toLowerCase();
        }

        // Получение иконки для типа файла
        function getFileTypeIcon(filename) {
            const ext = getFileExtension(filename);
            const icons = {
                'jpg': { icon: 'fas fa-image', ext: 'JPG' },
                'jpeg': { icon: 'fas fa-image', ext: 'JPG' },
                'png': { icon: 'fas fa-image', ext: 'PNG' },
                'gif': { icon: 'fas fa-image', ext: 'GIF' },
                'webp': { icon: 'fas fa-image', ext: 'WebP' },
                'svg': { icon: 'fas fa-image', ext: 'SVG' },
                'txt': { icon: 'fas fa-file-alt', ext: 'TXT' },
                'pdf': { icon: 'fas fa-file-pdf', ext: 'PDF' },
                'doc': { icon: 'fas fa-file-word', ext: 'DOC' },
                'docx': { icon: 'fas fa-file-word', ext: 'DOCX' },
                'xls': { icon: 'fas fa-file-excel', ext: 'XLS' },
                'xlsx': { icon: 'fas fa-file-excel', ext: 'XLSX' },
                'json': { icon: 'fas fa-code', ext: 'JSON' },
                'xml': { icon: 'far fa-file-code', ext: 'XML' },
                'csv': { icon: 'fas fa-table', ext: 'CSV' },
                'zip': { icon: 'far fa-file-archive', ext: 'ZIP' },
                'rar': { icon: 'far fa-file-archive', ext: 'RAR' }
            };
            
            return icons[ext] || { icon: 'fas fa-file', ext: ext.toUpperCase() };
        }
    </script>
</body>
</html>